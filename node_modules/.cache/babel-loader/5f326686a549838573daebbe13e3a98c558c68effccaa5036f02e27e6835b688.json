{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\nvar _Device = require('../Device');\nvar _Device2 = _interopRequireDefault(_Device);\nvar _logger = require('../logger');\nvar _logger2 = _interopRequireDefault(_logger);\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nvar logger = new _logger2.default('SSO.Google');\nvar default_options = {\n  google_client_id: null,\n  script: 'https://apis.google.com/js/platform.js',\n  scope: 'profile email openid'\n\n  /**\n  * Reference: https://developers.google.com/identity/sign-in/web/reference\n  */\n};\n\nvar Google = function () {\n  function Google(options) {\n    _classCallCheck(this, Google);\n    if (typeof options === 'string') {\n      options = {\n        google_client_id: options\n      };\n    }\n    this._options = Object.assign({}, default_options, options);\n    if (!this._options.google_client_id) {\n      logger.warn('missing google_client_id');\n    }\n    this.signIn = this.signIn.bind(this);\n    this.signOut = this.signOut.bind(this);\n    this.check = this.check.bind(this);\n    this.ready = this.ready.bind(this);\n    this._initGapi = this._initGapi.bind(this);\n    this._user = this._user.bind(this);\n    this._ga = null;\n    this._createScript();\n  }\n  _createClass(Google, [{\n    key: 'signIn',\n    value: function signIn() {\n      var _this = this;\n      if (!this._ga) {\n        return Promise.reject('no ga instance');\n      }\n      return this._ga.signIn().then(function (googleUser) {\n        return _this._user(googleUser);\n      });\n    }\n  }, {\n    key: 'signOut',\n    value: function signOut() {\n      if (!this._ga) {\n        return Promise.reject('no ga instance');\n      }\n      return this._ga.signOut();\n    }\n  }, {\n    key: 'check',\n    value: function check() {\n      var _this2 = this;\n      if (!this._ga) {\n        return Promise.reject('no ga instance');\n      }\n      return new Promise(function (resolve, reject) {\n        var googleUser = _this2._ga.currentUser.get();\n        if (!googleUser) {\n          reject('no google user');\n          return;\n        }\n        if (googleUser.isSignedIn()) {\n          resolve(_this2._user(googleUser));\n        } else {\n          reject('not signed in');\n        }\n      });\n    }\n  }, {\n    key: 'ready',\n    value: function ready() {\n      var google_client_id = this._options.google_client_id;\n      if (!google_client_id) {\n        return Promise.reject('missing google_client_id in options');\n      }\n      var that = this;\n      return new Promise(function (resolve, reject) {\n        var checkCount = 0;\n        var checkGA = function checkGA() {\n          checkCount++;\n          if (that._ga) {\n            resolve();\n            return;\n          }\n          if (window.gapi) {\n            that._initGapi();\n            return;\n          }\n          if (checkCount < 5) {\n            window.setTimeout(checkGA, 500);\n          } else {\n            reject('timeout');\n          }\n        };\n        checkGA();\n      });\n    }\n  }, {\n    key: '_user',\n    value: function _user(googleUser) {\n      var _googleUser$getAuthRe = googleUser.getAuthResponse(),\n        id_token = _googleUser$getAuthRe.id_token;\n      var profile = googleUser.getBasicProfile();\n      return {\n        id_token: id_token,\n        email: profile.getEmail(),\n        name: profile.getName()\n      };\n    }\n  }, {\n    key: '_createScript',\n    value: function _createScript() {\n      if (window.gapi) {\n        this._initGapi();\n        return;\n      }\n      var script = this._options.script;\n      if (script === 'none') {\n        return;\n      }\n      var src = this._options.script;\n      _Device2.default.createScript(src, true, this._initGapi);\n    }\n  }, {\n    key: '_initGapi',\n    value: function _initGapi() {\n      logger.debug('init gapi');\n      var _options = this._options,\n        google_client_id = _options.google_client_id,\n        scope = _options.scope;\n      if (!google_client_id) {\n        logger.warn('missing google_client_id in options');\n        return;\n      }\n      var that = this;\n      var g = window.gapi;\n      g.load('auth2', function () {\n        g.auth2.init({\n          client_id: google_client_id,\n          scope: scope\n        }).then(function (ga) {\n          that._ga = ga;\n        });\n      });\n    }\n  }]);\n  return Google;\n}();\nexports.default = Google;","map":{"version":3,"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_Device","require","_Device2","_interopRequireDefault","_logger","_logger2","obj","__esModule","default","_classCallCheck","instance","TypeError","logger","default_options","google_client_id","script","scope","Google","options","_options","assign","warn","signIn","bind","signOut","check","ready","_initGapi","_user","_ga","_createScript","_this","Promise","reject","then","googleUser","_this2","resolve","currentUser","get","isSignedIn","that","checkCount","checkGA","window","gapi","setTimeout","_googleUser$getAuthRe","getAuthResponse","id_token","profile","getBasicProfile","email","getEmail","name","getName","src","createScript","debug","g","load","auth2","init","client_id","ga"],"sources":["/Users/salguera/Documents/portfolio/node_modules/fsts/lib/sso/Google.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Device = require('../Device');\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _logger = require('../logger');\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar logger = new _logger2.default('SSO.Google');\n\nvar default_options = {\n    google_client_id: null,\n    script: 'https://apis.google.com/js/platform.js',\n    scope: 'profile email openid'\n\n    /**\n    * Reference: https://developers.google.com/identity/sign-in/web/reference\n    */\n};\nvar Google = function () {\n    function Google(options) {\n        _classCallCheck(this, Google);\n\n        if (typeof options === 'string') {\n            options = { google_client_id: options };\n        }\n        this._options = Object.assign({}, default_options, options);\n        if (!this._options.google_client_id) {\n            logger.warn('missing google_client_id');\n        }\n\n        this.signIn = this.signIn.bind(this);\n        this.signOut = this.signOut.bind(this);\n        this.check = this.check.bind(this);\n        this.ready = this.ready.bind(this);\n\n        this._initGapi = this._initGapi.bind(this);\n        this._user = this._user.bind(this);\n\n        this._ga = null;\n\n        this._createScript();\n    }\n\n    _createClass(Google, [{\n        key: 'signIn',\n        value: function signIn() {\n            var _this = this;\n\n            if (!this._ga) {\n                return Promise.reject('no ga instance');\n            }\n\n            return this._ga.signIn().then(function (googleUser) {\n                return _this._user(googleUser);\n            });\n        }\n    }, {\n        key: 'signOut',\n        value: function signOut() {\n            if (!this._ga) {\n                return Promise.reject('no ga instance');\n            }\n\n            return this._ga.signOut();\n        }\n    }, {\n        key: 'check',\n        value: function check() {\n            var _this2 = this;\n\n            if (!this._ga) {\n                return Promise.reject('no ga instance');\n            }\n\n            return new Promise(function (resolve, reject) {\n                var googleUser = _this2._ga.currentUser.get();\n                if (!googleUser) {\n                    reject('no google user');\n                    return;\n                }\n                if (googleUser.isSignedIn()) {\n                    resolve(_this2._user(googleUser));\n                } else {\n                    reject('not signed in');\n                }\n            });\n        }\n    }, {\n        key: 'ready',\n        value: function ready() {\n            var google_client_id = this._options.google_client_id;\n\n            if (!google_client_id) {\n                return Promise.reject('missing google_client_id in options');\n            }\n\n            var that = this;\n            return new Promise(function (resolve, reject) {\n                var checkCount = 0;\n                var checkGA = function checkGA() {\n                    checkCount++;\n                    if (that._ga) {\n                        resolve();\n                        return;\n                    }\n\n                    if (window.gapi) {\n                        that._initGapi();\n                        return;\n                    }\n\n                    if (checkCount < 5) {\n                        window.setTimeout(checkGA, 500);\n                    } else {\n                        reject('timeout');\n                    }\n                };\n                checkGA();\n            });\n        }\n    }, {\n        key: '_user',\n        value: function _user(googleUser) {\n            var _googleUser$getAuthRe = googleUser.getAuthResponse(),\n                id_token = _googleUser$getAuthRe.id_token;\n\n            var profile = googleUser.getBasicProfile();\n            return {\n                id_token: id_token,\n                email: profile.getEmail(),\n                name: profile.getName()\n            };\n        }\n    }, {\n        key: '_createScript',\n        value: function _createScript() {\n            if (window.gapi) {\n                this._initGapi();\n                return;\n            }\n\n            var script = this._options.script;\n\n            if (script === 'none') {\n                return;\n            }\n\n            var src = this._options.script;\n            _Device2.default.createScript(src, true, this._initGapi);\n        }\n    }, {\n        key: '_initGapi',\n        value: function _initGapi() {\n            logger.debug('init gapi');\n            var _options = this._options,\n                google_client_id = _options.google_client_id,\n                scope = _options.scope;\n\n            if (!google_client_id) {\n                logger.warn('missing google_client_id in options');\n                return;\n            }\n\n            var that = this;\n            var g = window.gapi;\n            g.load('auth2', function () {\n                g.auth2.init({\n                    client_id: google_client_id,\n                    scope: scope\n                }).then(function (ga) {\n                    that._ga = ga;\n                });\n            });\n        }\n    }]);\n\n    return Google;\n}();\n\nexports.default = Google;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}